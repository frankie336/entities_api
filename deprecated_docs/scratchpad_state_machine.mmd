stateDiagram-v2
    [*] --> STRATEGY : Supervisor initializes run
    [*] --> USER_DIRECTIVE : User intervenes during active run

    state "ğŸ“Œ STRATEGY  |  Supervisor-only  |  GOAL Â· ENTITIES Â· TOOL CHAIN Â· ASSIGNED" as STRATEGY
    state "ğŸ”„ PENDING   |  Worker-written   |  ENTITY Â· FIELD Â· assigned_to Â· turn" as PENDING
    state "âœ… VERIFIED  |  Worker-written   |  ENTITY Â· FIELD Â· VALUE Â· SOURCE_URL Â· retrieved_by" as VERIFIED
    state "â“ UNVERIFIED  |  Worker-written  |  ENTITY Â· FIELD Â· CLAIMED_VALUE Â· reason" as UNVERIFIED
    state "âš ï¸ FAILED_URL  |  Worker-written  |  URL Â· failure_reason Â· tried_by" as FAILED_URL
    state "â˜ ï¸ TOMBSTONE  |  Supervisor-only  |  URL Â· failure_reason Â· turn  PERMANENT" as TOMBSTONE
    state "ğŸ‘¤ USER DIRECTIVE  |  User-written via scratchpad UI  |  Non-destructive mid-stream" as USER_DIRECTIVE
    state "ğŸ“ SYNTHESIS  |  Supervisor-only  |  Only VERIFIED entries cited" as SYNTHESIS

    STRATEGY --> PENDING : Worker spawned - claims task
    PENDING --> VERIFIED : Fact confirmed with live URL
    PENDING --> UNVERIFIED : Value found - no confirmed URL
    PENDING --> FAILED_URL : URL blocked or dead
    UNVERIFIED --> PENDING : Supervisor re-delegates to new worker
    FAILED_URL --> TOMBSTONE : Supervisor promotes immediately
    TOMBSTONE --> PENDING : Supervisor issues new SERP query
    USER_DIRECTIVE --> STRATEGY : Supervisor reads on next evaluation cycle
    VERIFIED --> SYNTHESIS : All claims verified - zero PENDING - zero UNVERIFIED
    SYNTHESIS --> [*] : Final answer delivered - Redis TTL expires

    note right of STRATEGY
        Write permissions
        Supervisor only  ğŸ“Œ â˜ ï¸
        Worker only      ğŸ”„ âœ… â“ âš ï¸
        User only        ğŸ‘¤
    end note

    note right of VERIFIED
        Redis backend
        Atomic RPUSH - no race conditions
        Sub-millisecond reads
        TTL auto-cleanup per run
        Key format scratchpad:{thread_id}
    end note

    note right of USER_DIRECTIVE
        Upcoming feature
        Redis pub/sub notifies Supervisor
        No stream break required
        Operation continues with
        corrected intent
    end note