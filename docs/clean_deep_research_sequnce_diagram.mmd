sequenceDiagram
    autonumber
    participant User
    participant Supervisor as ≡ƒºá Supervisor (Orchestrator)
    participant ToolRouter as ≡ƒô¥ Tool Router
    participant Mixin as ≡ƒöä Delegation Mixin
    participant WorkerAPI as ≡ƒÆ╗ ProjectDavid API
    participant Worker as ≡ƒæÀ Research Worker (Ephemeral)
    participant Web as ≡ƒîÉ Live Tools

    Note over Supervisor, ToolRouter: PHASE 1: Supervisor Planning (DeepResearch=True)

    User->>Supervisor: "Research [Topic]"
    activate Supervisor
    Note right of Supervisor: Logic: web_access=False<br/>Injects: Supervisor SysPrompt
    Supervisor->>Supervisor: Generates Plan
    Supervisor->>ToolRouter: Emits <fc>delegate_research_task</fc>
    deactivate Supervisor

    activate ToolRouter
    ToolRouter->>Mixin: handle_delegate_research_task(task, requirements)
    deactivate ToolRouter

    Note over Mixin, Worker: PHASE 2: The Handoff (The "Clean" Break)

    activate Mixin
    Mixin->>WorkerAPI: create_ephemeral_worker_assistant()
    WorkerAPI-->>Mixin: Returns Worker ID
    Mixin->>WorkerAPI: create_thread() & create_message(TASK)

    Mixin->>WorkerAPI: synchronous_inference_stream(Start Run)
    activate WorkerAPI

    Note right of WorkerAPI: Spawns new QwenBaseWorker<br/>Config: Worker=True, WebAccess=True

    WorkerAPI->>Worker: Initialize Stream
    activate Worker

    Note over Worker, Web: PHASE 3: Worker Execution (The Logged Event)

    Worker->>Worker: Check Tools (Web Search Enabled)
    Worker->>Web: perform_web_search(query)
    Web-->>Worker: JSON Results
    Worker->>Web: read_web_page(url)
    Web-->>Worker: Page Content

    Worker->>Worker: Synthesize Answer
    Worker-->>WorkerAPI: Final Text Response
    deactivate Worker

    WorkerAPI-->>Mixin: Stream Complete (Events Yielded)
    deactivate WorkerAPI

    Mixin->>WorkerAPI: fetch_worker_final_report()
    WorkerAPI-->>Mixin: "Found data: X, Y, Z..."

    Mixin->>Supervisor: submit_tool_output(tool_call_id, content)
    deactivate Mixin

    Note over Supervisor, ToolRouter: PHASE 4: Synthesis

    activate Supervisor
    Supervisor->>User: "Based on the research report..."
    deactivate Supervisor